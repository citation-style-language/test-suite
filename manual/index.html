<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>The CSL Test Suite</title>
<style type="text/css">

p.fixed {
  position: fixed;
  top: 0;
  right: 0;
  padding-right: 0.5em;
  padding-left: 0.5em;
  margin-right: 0.5em;
  border: solid black 1px;
  background: white;
}

body { 
    width: 750px; 
    margin: auto; 
    position: center; 
    font-family: 'Lucida Sans', Verdana, sans-serif; 
    font-size: 10.5pt; 
    color: #434343;
    line-height: 135%; !important
}

.xml { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.relaxngcompact { padding: 1em; border: silver 1px solid; background: #F6F9ED; }

.clothesline {
  position: relative;
}

.double-border {
  border: 5px double black;
}

h4 a {
  padding: 4px;
  border: 1px solid black;
}

/* .js { padding: 1em; border: silver 1px solid; background: #FFF68F; } */
.js { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.text { padding: 1em; border: silver 1px solid; background: #FFcccc; }

dl { background: #B7FCE1; padding:1em; border: silver 1px solid;}
dt { font-weight: bold; margin-top: 0.5em; }

.info-version { text-align: center; font-size: 130%; font-weight: bold; }
.info-date { text-align: center; font-size: 110%; font-weight: bold; }
.title { text-align: center; margin: 4em 4em 1em 4em; }
.subtitle { text-align: center; margin: 1em 4em 4em 4em; }
.topic-title { font-weight: bold; font-size: 130%; }
.contents { margin-bottom: 1em; }
.center { text-align: center }



.contributors { margin-left: 250px; margin-top: 2em; margin-bottom: 2em; }
dl.contributors { background: white; border: none; }
.contributors dt { margin: 1em; }

span.sc {
  font-variant: small-caps;
  color: black;
}

tt.literal .pre {
  font-family: monospace;
  color: #232323;
  background: #d9d9d9;
  padding: 0px 2px 0px 2px;
}

a { 
    border-bottom: dotted 1px #999; 
    text-decoration: none;
}

blockquote {
    background: #B7FCE1; 
    margin-left: 3em;
    padding:1em; 
    border: silver 1px solid;
}

blockquote.inline-wrapper {
    background: white;
    margin: 0px;
    padding: 0px;
    border: 1px none black;
    text-align: center;
}

blockquote.inline-wrapper div {
    display: inline;
}

blockquote.inline-wrapper p {
    vertical-align: top;
    display: inline;
}

.superscript {
  margin-bottom: 1em;
}

a.toc-backref tt.literal .pre {
    background: white;
}


a:link { color: #636363; font-weight: bold;}
a:visited { color: #636363; font-weight: bold; }
a:active { color: #636363; font-weight: bold; }
a:hover { color: #a30826; font-weight: bold; }

a tt.literal .pre:link { color: #131313; }
a tt.literal .pre:visited { color: #131313; }
a tt.literal .pre:active { color: #131313; }
a tt.literal .pre:hover { color: #a30826; }

.contents a:link { color: #434343; font-weight: normal; }
.contents a:visited { color: #434343; font-weight: normal; }
.contents a:active { color: #434343; font-weight: normal; }
.contents a:hover { color: #a30826; }

a.toc-backref:link { color: black; } 
a.toc-backref:visited { color: black; } 
a.toc-backref:active { color: black; } 
a.toc-backref:hover { color: #a30826; }

blockquote.clothesline {
  position: relative;
  padding: 0px;
  margin: 0px;
  border: 0px none;
}

div.admonition {
  clear: both;
  border: 3px solid #c0c0c0;
  float: right;
  width: 37%;
  padding: 0px 5px 0px 5px;
  background: white;
  margin: -0.5em -0.5em 1em 5px;
}

blockquote.clothesline div.admonition {
  float: none;
  position: absolute;
  top: 0em;
  right: 0em;
}

div.admonition p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

div.admonition-important .admonition-title:before {
  content: url("important.png");
  padding-right: 5px;
}

div.admonition-hint .admonition-title:before {
  content: url("ktip.png");
  padding-right: 5px;
}

div.admonition p.admonition-title {
  font-weight: bold;
  font-size: 150%;
  border-bottom: 1px solid black;
  margin-top: 0px;
  margin-bottom: 0px;
  padding-top: 3px;
  padding-bottom: 3px;
}

table.footnote {
  background: #ffffdd;
  padding: 5px 0px 5px 0px;
  border: 1px solid #cccccc;
  margin: 0.3em 0px 0.3em 0px;
}

table.first {
  margin: 2.3em 0px 0.3em 0px;
}

table.hello { margin-left: 3em; }
table.hello td { padding: 3px; }
table.hello th { padding: 3px; background: #dddddd; }

table.footnote td.label {
  white-space: nowrap;
  padding-right: 0.3em;
}

a.fn-backref:before {
  content: url("2uparrow.png");
  padding-right: 2px;
}

a.footnote-reference {
  background: #ffffdd;
  padding: 5px 2px 0px 2px;
  white-space: nowrap;
}

a.footnote-reference:before {
  content: url("2downarrow.png");
  padding-right: 2px;
}

a.fn-backref {
  vertical-align: top;
}

/* .nx { color: red; font-weight: bold } */ /* Function name */

.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */

.k { color: #007020; font-weight: bold } /* Keyword  [DONE] */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #808080 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0040D0 } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */

table.codeblock, tr.codeblock, td.linenos, td.codeblock, table.codeblock pre { 
	margin: 0; 
	padding: 0; 
	border: 0; 
	vertical-align: baseline; 
	border: none; 
}

td.linenos { 
	border-right: 1px solid #AAAAAA; 
	text-align: right; 
	color: #AAAAAA; 
	padding-right: 5px; 
	padding-left: 5px; 
}

.codeblock { font-size: 110%; }

td.codeblock { padding-left: 5px; }
pre.codeblock { }
pre.codeblock span.Normal { }

pre.codeblock span.DataType { color: #902000; }
pre.codeblock span.DecVal { color: #40a070; }
pre.codeblock span.BaseN { color: #40a070; }
pre.codeblock span.Float { color: #40a070; }
pre.codeblock span.Char { color: #4070a0; }
pre.codeblock span.String { color: #4070a0; }
pre.codeblock span.Comment { color: #60a0b0; font-style: italic; }
pre.codeblock span.Others { color: #007020; }
pre.codeblock span.Alert { color: red; font-weight: bold; }
pre.codeblock span.Function { color: #06287e; }
pre.codeblock span.RegionMarker { }
pre.codeblock span.Error { color: red; font-weight: bold; }

</style>
</head>
<body>
<div class="document" id="the-csl-test-suite">
<h1 class="title">The CSL Test Suite</h1>
<h2 class="subtitle" id="developer-s-manual">Developer's Manual</h2>

<p class="fixed"><a class="reference external" href="http://citationstyles.org/">citationstyles.org</a></p>
<p class="info-version">version 1.00<sub>a2</sub></p>
<p class="info-date">25 May 2010</p>
<dl class="contributors docutils">
<dt>Author of this manual</dt>
<dd><ul class="first last simple">
<li>Frank G. Bennett, Jr.</li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#preparing-the-tests" id="id3">Preparing the tests</a></li>
<li><a class="reference internal" href="#fixture-layout" id="id4">Fixture layout</a><ul>
<li><a class="reference internal" href="#required-sections" id="id5">Required sections</a><ul>
<li><a class="reference internal" href="#mode" id="id6">MODE</a></li>
<li><a class="reference internal" href="#csl" id="id7">CSL</a></li>
<li><a class="reference internal" href="#input" id="id8">INPUT</a></li>
<li><a class="reference internal" href="#result" id="id9">RESULT</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-sections" id="id10">Optional sections</a><ul>
<li><a class="reference internal" href="#bibentries" id="id11">BIBENTRIES</a></li>
<li><a class="reference internal" href="#bibsection" id="id12">BIBSECTION</a></li>
<li><a class="reference internal" href="#citation-items" id="id13">CITATION-ITEMS</a></li>
<li><a class="reference internal" href="#citations" id="id14">CITATIONS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id2">Introduction</a></h1>
<p>CSL ships with a large bundle of test data for use in the
development and maintenance of CSL processors.  The tests begin as
individual human-friendly fixtures written in a special format, shown
in the sample file immediately below.  Tests are prepared for use by
grinding them into a machine-friendly form (JSON).  The JSON form
of tests can be run against processors in a test-bed environment
with processor-specific tools prepared for that purpose.</p>
</div>
<div class="section" id="preparing-the-tests">
<h1><a class="toc-backref" href="#id3">Preparing the tests</a></h1>
<p>Tests can be validated and prepared (or &quot;compiled&quot;) using
the <tt class="docutils literal"><span class="pre">./processor.py</span></tt> script in the root
directory of the archive.  The script accepts the following
options:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">--help</span></tt>:</dt>
<dd>List the script options with a brief description
of each and exit</dd>
<dt><tt class="docutils literal"><span class="pre">--cranky</span></tt></dt>
<dd>validate style code for testing against the
CSL schema using the <tt class="docutils literal"><span class="pre">jing</span></tt> XML tool.</dd>
<dt><tt class="docutils literal"><span class="pre">--grind</span></tt></dt>
<dd>Force grinding of human-readable test code into machine-
readable form.</dd>
<dt><tt class="docutils literal"><span class="pre">--verbose</span></tt></dt>
<dd>Display test names during processing.</dd>
</dl>
</div>
<div class="section" id="fixture-layout">
<h1><a class="toc-backref" href="#id4">Fixture layout</a></h1>
<p>The human-readable version of each test fixture is composed in
the format below.  The five sections <tt class="docutils literal"><span class="pre">MODE</span></tt>,
<tt class="docutils literal"><span class="pre">RESULT</span></tt>, <tt class="docutils literal"><span class="pre">CSL</span></tt> and <tt class="docutils literal"><span class="pre">INPUT</span></tt> are required, and may be
arranged in any order within the fixture file.  As the
sample below illustrates, text outside of the section
delimiters is ignored.  The sample file below shows the
layout of a typical fixture.  See the explanations of
the individual sections further below for information on
the usage of each.</p>
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">Four additional sections are available for special
purposes.  The optional sections
<tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt>, <tt class="docutils literal"><span class="pre">BIBSECTION</span></tt>, <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> and <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt>
are also explained below.</p>
</div>
</blockquote>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== MODE =====&gt;&gt;
citation
&lt;&lt;===== MODE =====&lt;&lt;

# Everything between the section blocks is
# ignored.  Comment markup can be used for
# clarity, but it is not required.


&gt;&gt;===== RESULT =====&gt;&gt;
John Doe
&lt;&lt;===== RESULT =====&lt;&lt;


&gt;&gt;===== CSL =====&gt;&gt;
&lt;style
      xmlns=&quot;http://purl.org/net/xbiblio/csl&quot;
      class=&quot;in-text&quot;
      version=&quot;1.0&quot;&gt;
  &lt;info&gt;
    &lt;id /&gt;
    &lt;title /&gt;
    &lt;updated&gt;2009-08-10T04:49:00+09:00&lt;/updated&gt;
  &lt;/info&gt;
  &lt;citation&gt;
    &lt;layout&gt;
      &lt;names variable=&quot;author&quot;&gt;
        &lt;name /&gt;
      &lt;/names&gt;
    &lt;/layout&gt;
  &lt;/citation&gt;
&lt;/style&gt;
&lt;&lt;===== CSL =====&lt;&lt;


&gt;&gt;===== INPUT =====&gt;&gt;
[
   {
      &quot;id&quot;:&quot;ID-1&quot;,
      &quot;type&quot;: &quot;book&quot;,
      &quot;author&quot;: [
         { &quot;name&quot;:&quot;Doe, John&quot; }
      ],
      &quot;issued&quot;: {
         &quot;date-parts&quot;: [
            [
               &quot;1965&quot;,
               &quot;6&quot;,
               &quot;1&quot;
            ]
         ]
      }
   }
]
&lt;&lt;===== INPUT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
<div class="section" id="required-sections">
<h2><a class="toc-backref" href="#id5">Required sections</a></h2>
<p>The following four sections (<tt class="docutils literal"><span class="pre">MODE</span></tt>, <tt class="docutils literal"><span class="pre">CSL</span></tt>, <tt class="docutils literal"><span class="pre">INPUT</span></tt>, <tt class="docutils literal"><span class="pre">RESULT</span></tt>)
are required in all test fixtures.</p>
<div class="section" id="mode">
<h3><a class="toc-backref" href="#id6">MODE</a></h3>
<p>A single string tells whether to test <tt class="docutils literal"><span class="pre">citation</span></tt> or <tt class="docutils literal"><span class="pre">bibliography</span></tt>
output.  In the former case, the test will be performed using
the <tt class="docutils literal"><span class="pre">makeCitationCluster()</span></tt> command if a <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt> area is
included in the test fixture, or if neither that nor a <tt class="docutils literal"><span class="pre">CITATIONS</span></tt>
area is included.  If a <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> area is included,
<tt class="docutils literal"><span class="pre">citation</span></tt> mode uses the <tt class="docutils literal"><span class="pre">processCitationCluster</span></tt> command.</p>
<p>In the case of <tt class="docutils literal"><span class="pre">bibliography</span></tt> mode, the bibliography generation
command should be used, with output possibly filtered by the conditions
specified in a <tt class="docutils literal"><span class="pre">BIBSECTION</span></tt> area:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== MODE =====&gt;&gt;
citation
&lt;&lt;===== MODE =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="csl">
<h3><a class="toc-backref" href="#id7">CSL</a></h3>
<p>The code to be used in the test must be valid
as a complete, if minimal, CSL style:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CSL =====&gt;&gt;
&lt;style
      xmlns=&quot;http://purl.org/net/xbiblio/csl&quot;
      class=&quot;in-text&quot;
      version=&quot;1.0&quot;&gt;
  &lt;info&gt;
    &lt;id /&gt;
    &lt;title /&gt;
    &lt;updated&gt;2009-08-10T04:49:00+09:00&lt;/updated&gt;
  &lt;/info&gt;
  &lt;citation
    et-al-min=&quot;3&quot;
    et-al-use-first=&quot;1&quot;&gt;
    &lt;layout delimiter=&quot;; &quot;&gt;
      &lt;group delimiter=&quot; &quot;&gt;
        &lt;names&gt;
          &lt;name form=&quot;short&quot;/&gt;
        &lt;/names&gt;
        &lt;date
            variable=&quot;issued&quot;
            date-parts=&quot;year&quot;
            form=&quot;text&quot;
            prefix=&quot;(&quot;
            suffix=&quot;)&quot;/&gt;
      &lt;/group&gt;
    &lt;/layout&gt;
  &lt;/citation&gt;
  &lt;bibliography&gt;
    &lt;layout&gt;
      &lt;group delimiter=&quot; &quot;&gt;
        &lt;names variable=&quot;author&quot;&gt;
          &lt;name delimiter=&quot; &quot; initialize-with=&quot;.&quot;/&gt;
        &lt;/names&gt;
        &lt;date
            variable=&quot;issued&quot;
            date-parts=&quot;year&quot;
            form=&quot;text&quot;
            prefix=&quot;(&quot;
            suffix=&quot;)&quot;/&gt;
      &lt;/group&gt;
    &lt;/layout&gt;
  &lt;/bibliography&gt;
&lt;/style&gt;
&lt;&lt;===== CSL =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="input">
<h3><a class="toc-backref" href="#id8">INPUT</a></h3>
<p>The <tt class="docutils literal"><span class="pre">INPUT</span></tt> section provides the item data to be registered
in the processor.  In a simple test fixture that contains
none of the optional areas <tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt>, <tt class="docutils literal"><span class="pre">BIBSECTION</span></tt> <tt class="docutils literal"><span class="pre">CITATIONS</span></tt>
or <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt>,
a citation or bibligraphy is requested for <em>all</em> of the
items in the <tt class="docutils literal"><span class="pre">INPUT</span></tt> section (where one of those two
optional sections is included, the testing behavior is slightly
different; see the discussion of the relevant sections below
for details):</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== INPUT =====&gt;&gt;
[
 {
   &quot;id&quot;:&quot;ID-1&quot;,
   &quot;author&quot;: [
        { &quot;name&quot;:&quot;Noakes, John&quot; },
        { &quot;name&quot;:&quot;Doe, John&quot; },
        { &quot;name&quot;:&quot;Roe, Jane&quot; }
   ],
   &quot;issued&quot;: {
      &quot;date-parts&quot;: [
         [
            2005
         ]
      ]
   }
 },
 {
   &quot;id&quot;:&quot;ID-2&quot;,
   &quot;author&quot;: [
        { &quot;name&quot;:&quot;Stoakes, Richard&quot; }
   ],
   &quot;issued&quot;: {
      &quot;date-parts&quot;: [
         [
            1898
         ]
      ]
   }
 }
]
&lt;&lt;===== INPUT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="result">
<h3><a class="toc-backref" href="#id9">RESULT</a></h3>
<p>A string to compare with the citation or bibliography output
received from the processor.</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== RESULT =====&gt;&gt;
(Noakes, et al. 2005; Stoakes 1898)
&lt;&lt;===== RESULT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
<p>Note that in <tt class="docutils literal"><span class="pre">bibliography</span></tt> mode, the HTML string output
used for testing will be affixed with a standard set of
wrapper tags, which must be written into the result string
used for comparison:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== RESULT =====&gt;&gt;
&lt;div class=&quot;csl-bib-body&quot;&gt;
  &lt;div class=&quot;csl-entry&quot;&gt;J. Noakes, J. Doe, J. Roe (2005)&lt;/div&gt;
  &lt;div class=&quot;csl-entry&quot;&gt;R. Stoakes (1898)&lt;/div&gt;
&lt;/div&gt;
&lt;&lt;===== RESULT =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="optional-sections">
<h2><a class="toc-backref" href="#id10">Optional sections</a></h2>
<p>Four optional sections are available for use in a fixture
to exercise special aspects of processor behavior.</p>
<div class="section" id="bibentries">
<h3><a class="toc-backref" href="#id11">BIBENTRIES</a></h3>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor maintains a persistent internal registry
of citation data, and permits the addition, deletion and rearrangement
of registered items.  The behavior of the processor across a series of
update transactions can be tested by including <tt class="docutils literal"><span class="pre">BIBENTRIES</span></tt> section.
When included, the section should consist of a two-tier list,
consisting of discrete lists of IDs, which must correspond to items
registered in the <tt class="docutils literal"><span class="pre">INPUT</span></tt> section:</p>
<!--  -->
<blockquote class="clothesline">
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The test of output will be run after first updating the
processor's internal registry to reflect each of the
requested citation sets, and should correctly reflect the
last in the series.</p>
</div>
</blockquote>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== BIBENTRIES =====&gt;&gt;
[
  [
    &quot;ITEM-1&quot;,
    &quot;ITEM-2&quot;,
    &quot;ITEM-3&quot;,
    &quot;ITEM-4&quot;,
    &quot;ITEM-5&quot;
  ],
  [
    &quot;ITEM-1&quot;,
    &quot;ITEM-4&quot;,
    &quot;ITEM-5&quot;
  ]
]
&lt;&lt;===== BIBENTRIES =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="bibsection">
<h3><a class="toc-backref" href="#id12">BIBSECTION</a></h3>
<p>When <tt class="docutils literal"><span class="pre">bibliography</span></tt> mode is used, a <tt class="docutils literal"><span class="pre">BIBSECTION</span></tt> area
can be used to limit the output of the bibligraphy.  The
filtering logic is described below, but first an example
of the way it looks in a test fixture:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== BIBSECTION =====&gt;&gt;
{
   &quot;include&quot; : [
      {
         &quot;field&quot; : &quot;categories&quot;,
         &quot;value&quot; : &quot;classical&quot;
      }
   ],
   &quot;quash&quot; : [
      {
         &quot;field&quot; : &quot;type&quot;,
         &quot;value&quot; : &quot;manuscript&quot;
      },
      {
         &quot;field&quot; : &quot;issued&quot;,
         &quot;value&quot; : &quot;&quot;
      }
   ]
}
&lt;&lt;===== BIBSECTION =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
<p>Filtering parameters for bibliography output are specified in a JSON object
that may contain
<em>one of</em> the objects <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">include</span></tt> or <tt class="docutils literal"><span class="pre">exclude</span></tt>, and
optionally an additional  <tt class="docutils literal"><span class="pre">quash</span></tt> object.  Each of these four objects
is an array containing one or more objects with <tt class="docutils literal"><span class="pre">field</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt>
attributes, each with a simple string value (see the examples below).
The matching behavior for each of the four object types, with accompanying
input examples, is as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">select</span></tt></dt>
<dd>For each item in the bibliography, try every match object in the array against
the item, and include the item if, and only if, <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The target field in the data items registered in the processor
may either be a string or an array.  In the latter case,
an array containing a value identical to the
relevant value is treated as a match.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;select&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>  <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="o">,</span>
          <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;1990s&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">include</span></tt></dt>
<dd>Try every match object in the array against the item, and include the
item if <em>any</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">exclude</span></tt></dt>
<dd>Include the item if <em>none</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;exclude&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legal_case&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legislation&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">quash</span></tt></dt>
<dd>Regardless of the result from <tt class="docutils literal"><span class="pre">select</span></tt>, <tt class="docutils literal"><span class="pre">include</span></tt> or <tt class="docutils literal"><span class="pre">exclude</span></tt>,
skip the item if <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">An empty string given as the field value will match items
for which that field is missing or has a nil value.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><div class="highlight"><pre><span class="k">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;classical&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span><span class="o">,</span>
   <span class="s2">&quot;quash&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;manuscript&quot;</span>
      <span class="p">}</span><span class="o">,</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;issued&quot;</span><span class="o">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="k">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="citation-items">
<h3><a class="toc-backref" href="#id13">CITATION-ITEMS</a></h3>
<p>When testing in <tt class="docutils literal"><span class="pre">citation</span></tt> mode, the data items to be
processed are ordinarily rendered as a single citation.
To test operations that depend upon or may be affected
by the internal state of the processor across a session,
either a <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt> or a <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> section
may be included in the test fixture (only one may be used
in a single test fixture).</p>
<p><tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt> is the simpler of the two, used in
most of the standard processor formatting test fixtures.
The data input in this area should consist of a list array
of cite data, where each cite consists of a Javascript object
containing, at least, item ID.
A single citation is composed of a list of cites, and
the full entry consists of a list of such citations:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CITATION-ITEMS =====&gt;&gt;
[
  [
    {&quot;id&quot;: &quot;ITEM-1&quot;}
  ],
  [
    {&quot;id&quot;: &quot;ITEM-2&quot;, &quot;label&quot;: &quot;page&quot;, &quot;locator&quot;: &quot;23&quot;},
    {&quot;id&quot;:&quot;ITEM-3&quot;}
  ]
]
&lt;&lt;===== CITATION-ITEMS =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="citations">
<h3><a class="toc-backref" href="#id14">CITATIONS</a></h3>
<p>A <tt class="docutils literal"><span class="pre">CITATIONS</span></tt> area can be used (instead of <tt class="docutils literal"><span class="pre">CITATION-ITEMS</span></tt>)
to mimic a series of interactions with a word processor plugin.
In this case, the area should contain a list array of citation
data objects with explict <tt class="docutils literal"><span class="pre">citationID</span></tt> values and ID list values
for subsequent invocations of the <tt class="docutils literal"><span class="pre">processCitationCluster()</span></tt> command,
like the following:</p>
<div class="codeblock text">
<table class="highlighttable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></td><td class="code"><div class="highlight"><pre>&gt;&gt;===== CITATIONS =====&gt;&gt;
[
   [
      {
         &quot;citationID&quot;: &quot;CITATION-1&quot;,
         &quot;citationItems&quot;: [
            {
               &quot;id&quot;: &quot;ITEM-1&quot;
            }
         ],
         &quot;properties&quot;: {
            &quot;noteIndex&quot;: 1
         }
      },
      [],
      []
   ],
   [
      {
         &quot;citationID&quot;: &quot;CITATION-2&quot;,
         &quot;citationItems&quot;: [
            {
               &quot;id&quot;: &quot;ITEM-2&quot;,
               &quot;locator&quot;: 15
            },
            {
               &quot;id&quot;: &quot;ITEM-3&quot;
            }
         ],
         &quot;properties&quot;: {
            &quot;noteIndex&quot;: 2
         }
      },
      [
        [
          &quot;CITATION-1&quot;,
          1
        ]
      ],
      []
   ]
]
&lt;&lt;===== CITATIONS =====&lt;&lt;
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
